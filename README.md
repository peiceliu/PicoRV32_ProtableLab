# 2024年全国大学生嵌入式芯片与系统设计竞赛——FPGA创新设计赛道
## 紫光同创赛题一：便携多功能仪
### 作品介绍：
1. 本项目旨在设计一个基于PicoRV32软核的便携多功能仪，我们一个系统可以实现四种常规传统仪器的功能：信号发生器、示波器、频谱仪和逻辑分析仪的功能，且能够通过HDMI接口输出波形显示。
2. 我们的信号发生器通过FPGA与DAC配合可以产生8种波形：方波、正弦波、三角波、锯齿波、脉冲波、噪声、谐波、梯形波等，DAC为双通道、速率125M、精度14bit，输出范围-5v到5v。配合自主开发的上位机软件可以实现1hz到15Mhz范围内的任意频率的波形输出、此外支持波形种类切换、波形幅值、电压偏置、相位实时调节，大大提高了便利性。频率最小分辨率可达1hz、输出电压最小分辨率可达1mv。
3. 我们的示波器通过FPGA与ADC配合进行实现，ADC为双通道、速率65Mhz、精度12bit，在采样精度上比一般ADC8bit，10bit精度更高，采集范围-5v到5v。相对于其他ADC具有更高的采样速率以及采样精度，配合自主开发的上位机软件加上软核的控制可以实现双通道任意切换、双通道独立工作以及频谱仪和DDS信号发生器五界面无卡顿切换显示，充分展现了多功能便携。支持示波器的时间分辨率、电压分辨率实时调节，时间分辨率从1us到1ms，电压分辨率从100mv到4v，还可以通过上位机软件来控制示波器的工作或者暂停，即run/stop；此外还支持波形的上下左右移动，触发电平实时调节。
4. 我们的示波器通过5寸便携HDMI显示屏（800x480像素）进行波形显示，显示界面支持：当前信号的频率、峰峰值、当前示波器的时间分辨率（水平分辨率）、电压分辨率（垂直分辨率），当前显示的通道（可同时实现双通道显示），当前波形的上下左右移动标记以及边沿是上升沿或者下降沿触发。对于双通道示波器的设计，通道一默认利于处理频率低于1Mhz和幅值不算太大的波形，通道二则利于处理频率高于1Mhz和幅值接近量程（正负5v）的；利用通道切换在一定程度上实现了AUTO功能，这样更利于用户不用更改设计即可实现波形的观测。同时可展现双通道波形，实现了对信号的并行采集和并行处理。
5. 我们的频谱仪可以实现将ADC采集的数据，送入自研的FFT ip核中进行FFT傅里叶变换，最终将信号的幅度谱以及检测的频率通过HDMI显示屏显示。同时频谱仪坐标刻度拥有自适应频率高低而进行切换的功能，能直接通过频谱观察出波形频率。我们的HDMI在便携的基础上相较于LCD显示屏具有更多的像素点、屏幕刷新率，波形显示效果更优。
6. 我们的逻辑分析仪通过FPGA与自主开发的逻辑分析仪上位机协同工作，可以控制FPGA何时开始进行采样、采样深度、采样速率、触发调节、触发通道为哪个，FPGA收到指示后进行采集，将采集到的数字信号存储到开发板DDR3中，当采集的数量满足我们以太网模块定义的udp包长度时，开始读出DDR3中的数据，将其通过以太网传输到上位机，上位机软件开启以太网监听，当FPGA的以太网ip发送数据等于设置的采样深度时，我们将所有的数据点在上位机中进行数字信号波形绘制，同时可以在上位机中选择当前解析协议，进行协议解析。我们的协议支持uart/rs232/485、spi、i2c、can、1-wire，同时可以设置每个协议的解析模式。我们的逻辑分析仪采用8G的DDR3可以实现大容量储存、最高采样深度可达1Gsa，采样速率最高500Mhz，同时通过以太网进行数据传输可以大大降低数据传输延迟，上位机也支持上述的多种协议解析功能。
### 技术特点：
1. 软硬协同工作
PicoRV32软核作为主控MCU与FPGA的并行处理能力相结合，系统实现多功能集成。软核负责与上位机交互、波形参数调节和示波器参数调节，而FPGA通过并行计算实现高速信号的生成与处理。通过软硬协同的思想进行合理分工，最大化系统性能与处理效率。
2. 高精度DAC与ADC
系统采用双通道14位精度、125 MHz速率的DAC，能够输出8种类型波形，包括正弦波、方波、三角波、锯齿波、脉冲波、谐波、梯形波及高斯白噪声，输出波形频率范围为1 Hz至15 MHz，最小频率分辨率1 Hz，电压输出范围-5V至5V，电压分辨率高达1 mV。ADC则采用12位精度、65 MHz速率，采集范围-5V至5V，确保了在高精度下的信号捕获。
3. 自研FFT IP核
自主开发的FFT算法大幅提升了频谱分析的实时性，能够在毫秒级时间内完成频域变换。系统通过HDMI显示实时更新频谱图，支持自适应频谱坐标切换，精准展现信号的频率特性，特别适用于高速信号的频谱分析。
4. 灵活的上位机软件控制
上位机软件提供了对信号发生、采集与分析的全方位控制。用户可以通过软件轻松调节信号频率、幅值、相位等参数，并对示波器和逻辑分析仪进行实时控制，包括时间分辨率、电压分辨率、通道选择、触发电平、波形移动、显示界面切换、采样速率、触发条件和协议解析等进行实时控制，极大提升了操作的便捷性。
5. 便携式HDMI显示
采用5寸800x480分辨率的便携式HDMI显示屏，相较于传统LCD屏幕，HDMI具备更高的刷新率和像素点密度，确保波形和频谱的显示更清晰流畅，适应便携使用场景。
### 性能指标：
1. 信号发生器
支持1 Hz至15 MHz范围内的任意频率波形输出，最小频率分辨率1 Hz，电压输出范围-5V至5V，电压分辨率达1 mV，支持8种波形类型，双通道独立工作，实时调整波形幅度、偏置和相位。
2. 示波器
具备65 MHz采样率的双通道ADC，12位采样精度，采样范围-5V至5V，时间分辨率1 µs至1 ms，电压分辨率100 mV至4 V，支持双通道同步显示，并可通过上位机实时调节采集参数，适用于从低频到高频信号的精确采集。
3. 频谱仪
系统基于自研的FFT IP核，能够快速计算信号的频率成分，HDMI屏幕实时显示信号的幅度谱和频率信息，支持自适应坐标切换，适合多频段信号的频谱分析。
4. 逻辑分析仪
支持最高500 MHz采样速率和1 GSa采样深度，8G DDR3存储容量，支持通过以太网进行数据传输，确保大规模数据采集的同时具备低延迟传输能力。支持UART、SPI、I2C、CAN、1-Wire等多种协议解析，且解析模块可灵活配置。
### 项目文件路径说明：
│ README.md								 作品介绍及完成性能指标
├─pg50_proj
│   ├─ 1_Hardware								 自制转接板PCB文件
│   ├─ 2_RTL_code								FPGA部分Verilog代码
│   │	├─ PicoRV32_SoC								 软核SoC
│   │	├─ Signal_Generator							   信号发生器
│   │	├─ Oscilloscope										示波器
│   │	├─ Spectrum_Analyzer									频谱仪
│   │	├─ Logic_Analyzer							   逻辑分析仪
│   │	├─ HDMI_Display							 HDMI显示屏
│   ├─ 3_Software				  软核C语言程序及上位机Python程序
│   └─ 4_Doc									比赛初期简易设计文档
├─reference_doc												 参考文献
│   ├─ 《11_以太网传输实验例程说明v1》
│   ├─ 《5_6_HDMI实验例程说明v2》
│   ├─ 《7_DDR读写实验例程说明v1》
│   ├─ 《ACM9226型双通道高速ADC模块用户手册》
│   ├─ 《ACM9767高速双通道DAC模块用户手册》
│   ├─ 《MES50HP开发板硬件使用手册_1V1》
│   ├─ 《PicoRV32 DEMO应用指南》
│   ├─ 《PicoRV32 IDE Quick Start应用指南v1.0》
│   └─ 《开拓者Nios II开发指南 V3.0》
